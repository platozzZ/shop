(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/evaluate/evaluating"],{"09c8":function(t,e,a){"use strict";a.r(e);var n=a("d676"),s=a("2be0");for(var o in s)"default"!==o&&function(t){a.d(e,t,(function(){return s[t]}))}(o);a("3ab6");var i,r=a("f0c5"),c=Object(r["a"])(s["default"],n["b"],n["c"],!1,null,"6eef8347",null,!1,n["a"],i);e["default"]=c.exports},1265:function(t,e,a){"use strict";(function(t){a("a1f9");n(a("66fd"));var e=n(a("09c8"));function n(t){return t&&t.__esModule?t:{default:t}}t(e.default)}).call(this,a("543d")["createPage"])},"2be0":function(t,e,a){"use strict";a.r(e);var n=a("87cc"),s=a.n(n);for(var o in n)"default"!==o&&function(t){a.d(e,t,(function(){return n[t]}))}(o);e["default"]=s.a},"3ab6":function(t,e,a){"use strict";var n=a("6962"),s=a.n(n);s.a},6962:function(t,e,a){},"87cc":function(t,e,a){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=s(a("4795"));a("b206");function s(t){return t&&t.__esModule?t:{default:t}}function o(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}function i(t,e,a,n,s,o,i){try{var r=t[o](i),c=r.value}catch(d){return void a(d)}r.done?e(c):Promise.resolve(c).then(n,s)}function r(t){return function(){var e=this,a=arguments;return new Promise((function(n,s){var o=t.apply(e,a);function r(t){i(o,n,s,r,c,"next",t)}function c(t){i(o,n,s,r,c,"throw",t)}r(void 0)}))}}var c=function(){Promise.all([a.e("common/vendor"),a.e("components/header")]).then(function(){return resolve(a("6c1c"))}.bind(null,a)).catch(a.oe)},d={data:function(){return{num:"",aaa:[9,8,7,6,5,4,3,2,1,0],title:"发布评价",order_details_id:"",access_id:"",goods:[],goodsId:[],desc:[],flag:[],index:"",stars:[],starnum:"",delete_img:this.LaiKeTuiCommon.LKT_ROOT_VERSION_URL+"images/icon1/delete2x.png",xiangji_img:this.LaiKeTuiCommon.LKT_ROOT_VERSION_URL+"images/icon1/xiangji2x.png",starOffImg:this.LaiKeTuiCommon.LKT_ROOT_VERSION_URL+"images/icon1/xing12x.png",starOnImg:this.LaiKeTuiCommon.LKT_ROOT_VERSION_URL+"images/icon1/xing22x.png",anonymous:this.LaiKeTuiCommon.LKT_ROOT_VERSION_URL+"images/icon1/gou2x.png",onanonymous:this.LaiKeTuiCommon.LKT_ROOT_VERSION_URL+"images/icon1/gouhei2x.png",mous:!0,data:[],imgsrc:"",show:!1,timeout:"",img_index:-1,requestTime:0,requestTime1:0,resImg:[],add:"",fastTap:!0,combotab:!1,staus:!0,show_zz:!1}},components:{heads:c},onLoad:function(e){this.access_id=t.getStorageSync("access_id")?t.getStorageSync("access_id"):this.$store.state.access_id,this.order_details_id=e.order_details_id,this.add=e.add,this.add&&(this.title="追加评价"),this.num=e.num,this.getEvaluatingData()},onShow:function(){var t=this;this.$nextTick((function(){t.$refs.lktAuthorizeComp.handleAfterAuth(t,"../login/login?landing_code=1")}))},computed:{remnant:function(){for(var t=[],e=0;e<this.desc.length;e++)t[e]=200-this.desc[e].length;return t}},methods:{changeLoginStatus:function(){this.access_id=t.getStorageSync("access_id"),this.getEvaluatingData()},_previewImg:function(e,a){t.previewImage({current:this.data[e].src[a],urls:this.data[e].src})},getEvaluatingData:function(){var e=this,a={module:"app",action:"product",app:"comment",order_details_id:this.order_details_id,access_id:this.access_id,num:this.num};this.add&&(a.type=1),this.$req.post({data:a}).then((function(a){if(200==a.code){e.goods=a.commentList,e.starnum=e.goods.length;var n=[];if(e.stars.length>0)e.stars=[];else if(e.flag.length>0)e.flag=[];else for(var s=0;s<e.goods.length;s++){e.flag.push(!1);for(var o=0;o<5;o++)n.push({show:!1});e.stars.push(n),e.data.push(new Object),n=[],e.data[s].commodityId=e.goods[s].commodityId,e.data[s].size=e.goods[s].size,e.data[s].attribute_id=e.goods[s].sid,e.data[s].cid="",e.data[s].index="",e.$set(e.data[s],"src",[]),e.$set(e.data[s],"base64_img",[])}}else t.showToast({title:a.data.message,duration:1500,icon:"none"})}))},rating:function(t,e,a){var n=0,s=this.stars[t].length;++e;while(n<s)this.stars[t][n].show=n<e,n++;this.data[t].starnum=e},_mous:function(){this.mous=!this.mous},submit:function(){var e=this;return r(n.default.mark((function a(){var s,i,r,c,d,u,l,m,f,h;return n.default.wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(!e.combotab){a.next=4;break}return a.abrupt("return",!1);case 4:e.combotab=!0,setTimeout((function(){e.combotab=!1}),2e3);case 6:e.fastTap=!1,s=0;case 8:if(!(s<e.data.length)){a.next=19;break}if(!(0==e.desc.length||""==e.desc[s]||e.desc.length<e.data.length)){a.next=15;break}return t.showToast({title:"请您为商品评价",duration:1500,icon:"none"}),e.fastTap=!0,a.abrupt("return");case 15:e.fastTap=!1;case 16:s++,a.next=8;break;case 19:if("追加评价"==e.title){a.next=32;break}i=0;case 21:if(!(i<e.data.length)){a.next=32;break}if(e.data[i].starnum||e.add){a.next=28;break}return t.showToast({title:"请为商品评分",duration:1500,icon:"none"}),e.fastTap=!0,a.abrupt("return",!1);case 28:e.fastTap=!0;case 29:i++,a.next=21;break;case 32:for(r=0;r<e.goods.length;r++)e.data[r].content=e.resImg[r];for(e.requestTime1=0,c=0;c<e.goods.length;c++)for(d=0;d<e.data[c].src.length;d++)e.requestTime1+=1;if(t.showLoading({title:"请稍后..."}),e.show_zz=!0,!e.add){a.next=41;break}for(u=0;u<e.goods.length;u++)0==e.requestTime1?(l={comment:e.desc[u],start:e.data[u].starnum,access_id:e.access_id,module:"app",action:"product",app:"t_comment",anonymous:e.mous?0:1},o(l,"access_id",e.access_id),o(l,"order_details_id",e.order_details_id),o(l,"goodsId",e.data[u].commodityId),o(l,"attributeId",e.data[u].attribute_id),o(l,"type","1"),o(l,"num",e.num),m=l,e.$req.post({data:m}).then((function(a){var n=a.code,s=a.message;200==n?(t.showToast({title:"提交成功",icon:"none",duration:1e3}),setTimeout((function(){t.redirectTo({url:"evaluatEnd"}),e.fastTap=!0}),1e3),e.show_zz=!1):(t.showToast({title:s,icon:"none",duration:1e3}),e.show_zz=!1,e.fastTap=!0)})).catch((function(t){e.fastTap=!0}))):e._Timg(u);a.next=52;break;case 41:f=0;case 42:if(!(f<e.goods.length)){a.next=52;break}if(h={comment:e.desc[f],start:e.data[f].starnum,access_id:e.access_id,module:"app",action:"product",app:"add_comment",anonymous:e.mous?0:1,order_details_id:e.order_details_id,goodsId:e.data[f].commodityId,attributeId:e.data[f].attribute_id,num:e.num},!e.staus){a.next=48;break}return a.next=47,e._Submission(f,h);case 47:h=a.sent;case 48:f+1==e.data.length&&t.hideLoading();case 49:f++,a.next=42;break;case 52:case"end":return a.stop()}}),a)})))()},_Submission:function(e,a){var s=this;return r(n.default.mark((function o(){var i;return n.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return i=s,n.abrupt("return",new Promise((function(n){t.request({data:a,url:t.getStorageSync("url"),header:{"content-type":"application/x-www-form-urlencoded"},method:"POST",success:function(a){200==a.data.code?(i.data[e].cid=a.data.cid,0==i.data[e].src.length?(t.showToast({title:"提交成功",icon:"none",duration:1500}),setTimeout((function(){i.fastTap=!0,t.redirectTo({url:"evaluatEnd"})}),1500)):i._img(e)):200!=a.data.code&&(i.fastTap=!0,t.showToast({title:a.data.message,icon:"none",duration:1e3}))},error:function(t){i.fastTap=!0}})})));case 2:case"end":return n.stop()}}),o)})))()},_img:function(t){var e=this;return r(n.default.mark((function a(){var s,o,i;return n.default.wrap((function(a){while(1)switch(a.prev=a.next){case 0:s=e,o=0;case 2:if(!(o<s.data[t].src.length)){a.next=11;break}return i={access_id:s.access_id,module:"app",action:"product",app:"img_comment",cid:s.data[t].cid,upload_z_num:s.data[t].src.length,upload_num:o},i.store_type=1,a.next=7,e._upload(t,o,i);case 7:i=a.sent;case 8:o++,a.next=2;break;case 11:case"end":return a.stop()}}),a)})))()},_upload:function(e,a,n){var s=this;return new Promise((function(o){t.uploadFile({url:t.getStorageSync("url"),filePath:s.data[e].src[a],name:"file",formData:n,success:function(n){var i=JSON.parse(n.data);s.fastTap=!0,200==i.code?(a++,a==s.data[e].src.length&&s.data.length-e==1?(s.fastTap=!0,s.staus=!1,t.showToast({title:"提交成功",duration:1500,icon:"none"}),setTimeout((function(){t.navigateBack({delta:1})}),1500)):s.staus=!0,o(i)):t.showToast({title:i.status,duration:1500,icon:"none"})},error:function(){s.fastTap=!0}})}))},_Timg:function(t){var e=this;return r(n.default.mark((function a(){var s,o,i;return n.default.wrap((function(a){while(1)switch(a.prev=a.next){case 0:s=e,o=0;case 2:if(!(o<s.data[t].src.length)){a.next=11;break}return i={access_id:s.access_id,module:"app",action:"product",app:"t_comment",anonymous:s.mous?0:1,order_details_id:s.order_details_id,start:s.data[t].starnum,comment:s.desc[t],goodsId:s.data[t].commodityId,attributeId:s.data[t].attribute_id,upload_z_num:s.data[t].src.length,upload_num:o},i.store_type=1,a.next=7,e._upload(t,o,i);case 7:i=a.sent;case 8:o++,a.next=2;break;case 11:case"end":return a.stop()}}),a)})))()},choiceImg:function(e,a){var n=this,s=Number(this.aaa[a]);t.chooseImage({count:s,sizeType:["original","compressed"],sourceType:["album","camera"],success:function(t){n.resImg=n.resImg.concat(t.tempFilePaths),n.data[e].src=n.data[e].src.concat(t.tempFilePaths)}})},_delete:function(t,e){this.data[t].src.length>0&&(this.data[t].src.splice(e,1),this.resImg.splice(e,1))}}};e.default=d}).call(this,a("543d")["default"])},d676:function(t,e,a){"use strict";var n,s=function(){var t=this,e=t.$createElement;t._self._c},o=[];a.d(e,"b",(function(){return s})),a.d(e,"c",(function(){return o})),a.d(e,"a",(function(){return n}))}},[["1265","common/runtime","common/vendor"]]]);